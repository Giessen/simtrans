#VRML V2.0 utf8

Shape {
  {%- for c in mesh.children recursive %}
  {%- if c.matrix is defined %}
  Transform {
    {%- set scale = c.getscale() %}
    scale {{scale[0]}} {{scale[1]}} {{scale[2]}}
    {%- set trans = c.gettranslation() %}
    translation {{trans[0]}} {{trans[1]}} {{trans[2]}}
    {%- set angle = c.getangle() %}
    rotation {{angle[1][0]}} {{angle[1][1]}} {{angle[1][2]}} {{angle[0]}}
    {%- if c.children %}
    children [
      {{ loop(c.children)|indent(4, True) }}
    ]
    {%- endif %}
  }
  {%- else %}
  appearance Appearance {
    material Material {
      diffuseColor 0.85 0.85 0.85
      specularColor 0.85 0.85 0.85
      emissiveColor 0.05 0.05 0.05
    }
    {%- if c.image is not none %}
    texture ImageTexture {
      url "{{c.image}}"
    }
    {%- endif %}
  }
  geometry IndexedFaceSet {
    coord Coordinate {
      point [
        {%- for n in c.vertex %}
        {{n[0]}} {{n[1]}} {{n[2]}},
        {%- endfor %}
      ]
    }
    coordIndex [
      {%- for n in c.vertex_index %}
      {{n[0]}}, {{n[1]}}, {{n[2]}}, -1,
      {%- endfor %}
    ]
    {%- if c.normal is not none %}
    normal Normal {
      vector [
        {%- for n in c.normal %}
        {{n[0]}} {{n[1]}} {{n[2]}},
        {%- endfor %}
      ]
    }
    normalIndex [
      {%- for n in c.normal_index %}
      {{n[0]}}, {{n[1]}}, {{n[2]}}, -1,
      {%- endfor %}
    ]
    normalPerVertex TRUE
    {%- else %}
    normalPerVertex FALSE
    {%- endif %}
    {%- if c.color is not none %}
    color Color {
      vector [
        {%- for n in c.color %}
        {{n[0]}} {{n[1]}} {{n[2]}},
        {%- endfor %}
      ]
    }
    colorIndex [
      {%- for n in c.color_index %}
      {{n[0]}}, {{n[1]}}, {{n[2]}}, -1,
      {%- endfor %}
    ]
    colorPerVertex TRUE
    {%- else %}
    colorPerVertex FALSE
    {%- endif %}
    {%- if c.uvmap is not none %}
    texCoord TextureCoordinate {
      point [
        {%- for n in c.uvmap %}
        {{n[0]}} {{n[1]}},
        {%- endfor %}
      ]
    }
    texCoordIndex [
      {%- for n in c.uvmap_index %}
      {{n[0]}}, {{n[1]}}, {{n[2]}}, -1,
      {%- endfor %}
    ]
    {%- endif %}
  }
  {%- endif %}
  {%- endfor %}
}
